{% extends "main.tpl.twig" %}
{% block title %}Статистика{% endblock %}
{% block scripts %}
	<script>
		$(document).ready(function(){
			var date = new Date();
			var year = date.getFullYear();
			var month = (date.getMonth()+1);
			if(month<10){
				month = '0'+month;
			}
			$('#select').val(year+'-'+month);
			$('#select').on('change', function(){
				var date = $(this).val();
				$.post('{{site}}/stats/', {date: date})
						.success(function (data){
							$('#table').html(data);
						});
			});
		});
	</script>
	<style>		
		.table {
			width: 600px;
			margin-top:20px;
		}
		.table th{
			padding:7px;
		}
		.table td{
			border: 1px solid #cccccc;
			text-align: right;
		}
		#select{
			margin-bottom:10px;
		}

	</style>
{% endblock %}
{% block body %}
	<div class="content-header">
		<h1>Статистика</h1>
		
		<select id="select">
			
			<optgroup label="2021">							
				<option value="2021-12">12.2021</option>
				<option value="2021-11">11.2021</option>
				<option value="2021-10">10.2021</option>
				<option value="2021-09">09.2021</option>
				<option value="2021-08">08.2021</option>
				<option value="2021-07">07.2021</option>
				<option value="2021-06">06.2021</option>
				<option value="2021-05">05.2021</option>
				<option value="2021-04">04.2021</option>
				<option value="2021-03">03.2021</option>
				<option value="2021-02">02.2021</option>
				<option value="2021-01">01.2021</option>				
			</optgroup>	
			
			<optgroup label="2020">							
				<option value="2020-12">12.2020</option>
				<option value="2020-11">11.2020</option>
				<option value="2020-10">10.2020</option>
				<option value="2020-09">09.2020</option>
				<option value="2020-08">08.2020</option>
				<option value="2020-07">07.2020</option>
				<option value="2020-06">06.2020</option>
				<option value="2020-05">05.2020</option>
				<option value="2020-04">04.2020</option>
				<option value="2020-03">03.2020</option>
				<option value="2020-02">02.2020</option>
				<option value="2020-01">01.2020</option>				
			</optgroup>	
			
			<optgroup label="2019">							
				<option value="2019-12">12.2019</option>
				<option value="2019-11">11.2019</option>
				<option value="2019-10">10.2019</option>
				<option value="2019-09">09.2019</option>
				<option value="2019-08">08.2019</option>
				<option value="2019-07">07.2019</option>
				<option value="2019-06">06.2019</option>
				<option value="2019-05">05.2019</option>
				<option value="2019-04">04.2019</option>
				<option value="2019-03">03.2019</option>
				<option value="2019-02">02.2019</option>
				<option value="2019-01">01.2019</option>				
			</optgroup>	
			
			<optgroup label="2018">							
				<option value="2018-12">12.2018</option>
				<option value="2018-11">11.2018</option>
				<option value="2018-10">10.2018</option>
				<option value="2018-09">09.2018</option>
				<option value="2018-08">08.2018</option>
				<option value="2018-07">07.2018</option>
				<option value="2018-06">06.2018</option>
				<option value="2018-05">05.2018</option>
				<option value="2018-04">04.2018</option>
				<option value="2018-03">03.2018</option>
				<option value="2018-02">02.2018</option>
				<option value="2018-01">01.2018</option>				
			</optgroup>	
			
			<optgroup label="2017">							
				<option value="2017-12">12.2017</option>
				<option value="2017-11">11.2017</option>
				<option value="2017-10">10.2017</option>
				<option value="2017-09">09.2017</option>
				<option value="2017-08">08.2017</option>
				<option value="2017-07">07.2017</option>
				<option value="2017-06">06.2017</option>
				<option value="2017-05">05.2017</option>
				<option value="2017-04">04.2017</option>
				<option value="2017-03">03.2017</option>
				<option value="2017-02">02.2017</option>
				<option value="2017-01">01.2017</option>				
			</optgroup>	
			
			<optgroup label="2016">							
				<option value="2016-12">12.2016</option>
				<option value="2016-11">11.2016</option>
				<option value="2016-10">10.2016</option>
				<option value="2016-09">09.2016</option>
				<option value="2016-08">08.2016</option>
				<option value="2016-07">07.2016</option>
				<option value="2016-06">06.2016</option>
				<option value="2016-05">05.2016</option>
				<option value="2016-04">04.2016</option>
				<option value="2016-03">03.2016</option>
				<option value="2016-02">02.2016</option>
				<option value="2016-01">01.2016</option>				
			</optgroup>	
			
			<optgroup label="2015">							
				<option value="2015-12">12.2015</option>
				<option value="2015-11">11.2015</option>
				<option value="2015-10">10.2015</option>
				<option value="2015-09">09.2015</option>
				<option value="2015-08">08.2015</option>
				<option value="2015-07">07.2015</option>
				<option value="2015-06">06.2015</option>
				<option value="2015-05">05.2015</option>
				<option value="2015-04">04.2015</option>
				<option value="2015-03">03.2015</option>
				<option value="2015-02">02.2015</option>
				<option value="2015-01">01.2015</option>				
			</optgroup>	
		
			
		</select>
			
	</div>
	<div id="table">
		<table class="table">
			<thead>
				<tr>
					<th>Число</th>
					<th>Всего</th>
					<th>з/п мастер</th>
					<th>Ж. сервис</th>					
					<th>Ж. партнер</th>					
					<th>Касса</th>					
					<th>Заказы</th>
				</tr>
			</thead>
			<tbody>
			{% set work, hard, service, all, requests = 0, 0, 0, 0, 0 %}
			{% set break = false %}
			{% set tomorrow = "now"|date("Y-m-d") %}
			{% for key, day in data if not break %}
				<tr>
					<td>{{key is empty ? "" : key|date("d")}} {{month.monthA}}</td>
					<td style="font-weight: bold;">{{day.day_money.all is empty ? "0 руб." : '%s руб.'|format(day.day_money.all)}}</td>
					<td>{{day.day_money.work is empty ? "0 руб." : '%s руб.'|format(day.day_money.work)}}</td>
					<td>{{day.day_money.service is empty ? "0 руб." : '%s руб.'|format(day.day_money.service)}}</td>					
					<td>{{day.day_money.hard is empty ? "0 руб." : '%s руб.'|format(day.day_money.hard)}}</td>					
					<td style="background:#d4ecb86b;">{{day.day_money.all - day.day_money.work - day.day_money.hard}} руб.</td>
					<td>{{day.request}}</td>					
					{% set work = work + day.day_money.work %}
					{% set service = service + day.day_money.service %}
					{% set hard = hard + day.day_money.hard %}
					{% set all = all + day.day_money.all %}
					{% set requests = requests + day.request %}
					{% if key == tomorrow %}
						{% set break = true %}
					{% endif %}
				</tr>
			{% endfor %}
			<tr>
				<td style="font-weight: bold;background:#eee;">ИТОГО:</td>
				<td style="font-weight: bold;background:#eee;">{{all}} руб.</td>
				<td style="font-weight: bold;background:#eee;">{{work}} руб.</td>
				<td style="font-weight: bold;background:#eee;">{{service}} руб.</td>
				<td style="font-weight: bold;background:#eee;">{{hard}} руб.</td>				
				<td style="font-weight: bold;background:#d4ecb8;">{{all - work - hard}} руб.</td>
				<td style="font-weight: bold;background:#eee;">{{requests}}</td>
			</tr>
			</tbody>
		</table>

	</div>
	
	<div style="display:inline-block;margin-top:15px;font-size:16px;font-weight:bold;background:#fff178;padding:10px 15px;">Средний чек за месяц: {{ (all / requests)|round  }} руб.</div>
	
{% endblock %}